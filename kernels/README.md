# CORTEX Kernel Registry

This directory contains versioned kernel specifications for the CORTEX benchmarking system.

## Purpose

The kernel registry provides:
- **Machine-readable specifications** (`spec.yaml`) for harness/tests to consume
- **Comprehensive documentation** (`README.md`) with equations, edge cases, and usage
- **Reference implementations** (`oracle.py`) for numerical validation

## Versioning Scheme

Kernels are organized by version:
- `v1/` - Initial float32 implementations (Fall 2025)
- `v2/` - Future quantized implementations (Q15, Q7) when implemented

## Kernel Naming Convention

Format: `{name}@{dtype}`
- `name`: Kernel identifier (e.g., `car`, `notch_iir`, `fir_bandpass`, `goertzel`)
- `dtype`: Data type tag (`f32`, `q15`, `q7`)

Example: `car@f32` is the float32 version of Common Average Reference.

## Directory Structure

Each kernel directory contains:
```
{name}@{dtype}/
├── spec.yaml       # Minimal machine-readable spec (used by harness/tests)
├── README.md       # Full documentation with equations, edge cases, parameters
├── oracle.py       # Python reference implementation for validation
├── {name}.c        # C implementation of the kernel
├── Makefile        # Build script for the C plugin
└── lib{name}.dylib # Compiled plugin (generated by Makefile)
```

## Adding New Kernels

1. Create directory: `kernels/v1/{name}@{dtype}/`
2. Write `spec.yaml` with minimal fields:
   - `kernel`: name, version, dtype
   - `abi`: input_shape, output_shape, stateful
   - `numerical`: tolerances
   - `oracle`: path, function, dependencies
3. Write `README.md` with:
   - Signal model equations
   - Parameters and defaults
   - Edge case handling
   - Acceptance criteria
   - Usage examples
4. Write `oracle.py` with reference implementation
5. Write `{name}.c` implementing the cortex kernel ABI
6. Copy `Makefile` template from another kernel and update
7. Build: `cd kernels/v1/{name}@{dtype} && make`
8. The harness will automatically load `lib{name}.dylib` from this directory

## Spec Validation

Test your kernel spec:
```bash
cd kernels/v1/{name}@{dtype}
python oracle.py  # Should run without errors
```

## Fixed Parameters (EEG v1)

All kernels assume:
- **Sampling Rate (Fs)**: 160 Hz
- **Window Length (W)**: 160 samples
- **Hop (H)**: 80 samples
- **Channels (C)**: 64
- **Units**: µV

See `docs/KERNELS.md` for detailed mathematical specifications.

## References

- Mathematical specifications: `docs/KERNELS.md`
- Plugin interface: `docs/PLUGIN_INTERFACE.md`
- Run configuration: `docs/RUN_CONFIG.md`

